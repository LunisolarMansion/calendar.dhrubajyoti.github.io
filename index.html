<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Activity Calendar</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="evo-calendar.min.css">
<link rel="stylesheet" href="evo-calendar.midnight-blue.min.css">
<link rel="stylesheet" href="style.css">
</head>

<body>

<div class="hero">
    <div class="content-flow">

        <!-- CALENDAR -->
        <div id="calendar"></div>

        <!-- QUOTE -->
        <div id="monthly-quote">
            <p id="quote-text"></p>
        </div>

        <!-- MONTHLY PANELS -->
        <div id="monthly-events">
            <div class="monthly-grid">

                <!-- TASKS -->
                <div class="monthly-right collapsible">
                    <h4 class="collapsible-header">Important Tasks / Milestones</h4>
                    <div class="collapsible-body">
                        <ul id="task-list"></ul>
                    </div>
                </div>

                <!-- KEY DATES -->
                <div class="monthly-left collapsible">
                    <h4 class="collapsible-header">
                        Month's Key Dates to Help You Plan the Month
                    </h4>
                    <div class="collapsible-body">
                        <ul id="event-list"></ul>
                    </div>
                </div>

            </div>
        </div>

    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script>
<script src="evo-calendar.min.js"></script>

<!-- External Data -->
<script src="calendar-events.js"></script>

<script>
let taskData = [];

const monthQuotes = [
    "The beginning of the year is the perfect time to set your goals high and work tirelessly toward them.",
    "A workplace isn't just a space to work; it's a space to grow.",
    "Teamwork transforms effort into excellence.",
    "Collaboration unlocks creative potential.",
    "Consistency is the bridge between goals and achievement.",
    "A positive workplace is the foundation of success.",
    "Teamwork fuels extraordinary outcomes.",
    "Great achievements are built together.",
    "Hard work turns dreams into reality.",
    "Every challenge is an opportunity to grow.",
    "Motivation multiplies when shared.",
    "Finish strong, together."
];

/* ===== ACTIVE YEAR & MONTH FROM EVO CALENDAR ===== */
function getActiveYearMonth() {
    const activeDate = $('#calendar').evoCalendar('getActiveDate');
    const d = new Date(activeDate);
    return { year: d.getFullYear(), month: d.getMonth() };
}

/* ===== KEY DATES ===== */
function populateMonthlyEvents() {
    const list = $('#event-list').empty();
    const { year, month } = getActiveYearMonth();

    const filtered = calendarEvents.filter(ev => {
        const d = new Date(ev.date);
        return d.getFullYear() === year && d.getMonth() === month;
    });

    if (!filtered.length) {
        list.append('<li class="muted">No key dates this month.</li>');
        return;
    }

    filtered.sort((a,b)=>new Date(a.date)-new Date(b.date))
        .forEach(ev => {
            const d = new Date(ev.date);
            list.append(`
                <li>
                    <span class="date">${String(d.getDate()).padStart(2,'0')}/${String(d.getMonth()+1).padStart(2,'0')}/${d.getFullYear()}</span>
                    <span style="color:${ev.color}"> – ${ev.description}</span>
                </li>
            `);
        });
}

/* ===== TASKS ===== */
function populateMonthlyTasks() {
    const list = $('#task-list').empty();
    const { year, month } = getActiveYearMonth();

    taskData.forEach(t => {
        const s = new Date(t.start);
        const e = new Date(t.end);

        if (
            (s.getFullYear() === year && s.getMonth() === month) ||
            (e.getFullYear() === year && e.getMonth() === month)
        ) {
            list.append(`
                <li>
                    <span class="task-period">${fmt(s)} – ${fmt(e)}</span><br>
                    <span class="task-text">${t.description}</span>
                </li>
            `);
        }
    });
}

function fmt(d){
    return `${String(d.getDate()).padStart(2,'0')}/${String(d.getMonth()+1).padStart(2,'0')}/${d.getFullYear()}`;
}

/* ===== INIT ===== */
$(document).ready(function () {

    $('#calendar').evoCalendar({
        theme: 'midnight-blue',
        calendarEvents: calendarEvents
    });

    fetch('tasks.json')
        .then(r => r.json())
        .then(data => {
            taskData = data;
            refreshPanels();
        });

    function refreshPanels() {
        const { month } = getActiveYearMonth();
        $('#quote-text').text(monthQuotes[month]);
        populateMonthlyEvents();
        populateMonthlyTasks();
    }

    $('#calendar').on('selectMonth selectYear', refreshPanels);

    $('.collapsible-header').on('click', function(){
        $(this).next('.collapsible-body').slideToggle();
    });

    refreshPanels();
});
</script>

</body>
</html>
