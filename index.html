<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Activity Calendar</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="evo-calendar.min.css">
<link rel="stylesheet" href="evo-calendar.midnight-blue.min.css">
<link rel="stylesheet" href="style.css">
</head>

<body>

<div class="hero">

    <div id="calendar"></div>

    <!-- QUOTE -->
    <div id="monthly-quote">
        <p id="quote-text"></p>
    </div>

    <!-- PANELS -->
    <div class="monthly-grid">

        <!-- TASKS -->
        <div>
            <h4 class="section-title">Important Tasks / Milestones</h4>
            <ul id="task-list"></ul>
        </div>

        <!-- KEY DATES -->
        <div>
            <h4 class="section-title">Month's Key Dates to Help You Plan the Month</h4>
            <ul id="event-list"></ul>
        </div>

    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script>
<script src="evo-calendar.min.js"></script>
<script src="calendar-events.js"></script>

<script>
/* ================= QUOTES ================= */
const monthQuotes = [
    "The beginning of the year is the perfect time to set your goals high and work tirelessly toward them.",
    "A workplace isn't just a space to work; it's a space to grow.",
    "Teamwork transforms effort into excellence.",
    "Collaboration unlocks creative potential.",
    "Consistency is the bridge between goals and achievement.",
    "A positive workplace is the foundation of success.",
    "Teamwork fuels extraordinary outcomes.",
    "Great achievements are built together.",
    "Hard work turns dreams into reality.",
    "Every challenge is an opportunity to grow.",
    "Motivation multiplies when shared.",
    "Finish strong, together."
];

/* ================= INIT CALENDAR ================= */
$('#calendar').evoCalendar({
    theme: 'midnight-blue',
    calendarEvents: calendarEvents
});

/* ================= LOAD TASKS ================= */
let taskData = [];
fetch('tasks.json')
    .then(r => r.json())
    .then(d => {
        taskData = d;
        syncPanels();
    });

/* ================= CORE SYNC FUNCTION ================= */
function syncPanels() {

    const activeDate = $('#calendar').evoCalendar('getActiveDate');
    const d = new Date(activeDate);

    const year = d.getFullYear();
    const month = d.getMonth();

    /* QUOTE */
    $('#quote-text').text(monthQuotes[month]);

    /* KEY DATES */
    const eventList = $('#event-list').empty();
    const events = calendarEvents.filter(e => {
        const ed = new Date(e.date);
        return ed.getFullYear() === year && ed.getMonth() === month;
    });

    if (!events.length) {
        eventList.append('<li class="empty">No key dates this month.</li>');
    } else {
        events.sort((a,b)=>new Date(a.date)-new Date(b.date));
        events.forEach(e=>{
            eventList.append(`
                <li>
                    <span>${format(e.date)}</span> —
                    <span style="color:${e.color}">${e.description}</span>
                </li>
            `);
        });
    }

    /* TASKS */
    const taskList = $('#task-list').empty();
    const today = new Date();

    const tasks = taskData.filter(t=>{
        const s = new Date(t.start);
        const e = new Date(t.end);
        return (
            (s.getFullYear() === year && s.getMonth() === month) ||
            (e.getFullYear() === year && e.getMonth() === month)
        );
    });

    if (!tasks.length) {
        taskList.append('<li class="empty">No tasks this month.</li>');
    } else {
        tasks.forEach(t=>{
            const end = new Date(t.end);
            const diff = Math.ceil((end - today)/(86400000));
            const cd = diff < 0 ? 'OVERDUE' : diff === 0 ? 'D-DAY' : `D-${diff}`;
            taskList.append(`
                <li>
                    <span class="task-date">${format(t.start)} – ${format(t.end)}</span>
                    <span class="countdown">${cd}</span><br>
                    <span class="task-text">${t.description}</span>
                </li>
            `);
        });
    }
}

/* ================= LISTENERS ================= */
$('#calendar').on('selectDate changeMonth changeYear', syncPanels);

/* ================= HELPERS ================= */
function format(d){
    const x = new Date(d);
    return String(x.getDate()).padStart(2,'0')+'/'+
           String(x.getMonth()+1).padStart(2,'0')+'/'+
           x.getFullYear();
}
</script>

</body>
</html>
